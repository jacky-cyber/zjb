<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="pragram" content="no-cache"> 
<meta http-equiv="cache-control" content="no-cache, must-revalidate"> 
<meta http-equiv="expires" content="0"> 
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>中介宝房源软件系统</title>
<meta name="description" content="中介宝房源软件系统">
<meta name="keywords" content="房源软件,房源系统,中介宝">
<link href="/style/css.css" rel="stylesheet">
<link href="/bootstrap/css/bootstrap.css" rel="stylesheet">
<link href="/style/style.css" rel="stylesheet">
<script src="/js/jquery.js" type="text/javascript"></script>
<script src="/bootstrap/js/bootstrap.js" type="text/javascript"></script>
<script src="/js/dialog/jquery.artDialog.source.js?skin=win8s" type="text/javascript"></script>
<script src="/js/dialog/plugins/iframeTools.source.js" type="text/javascript"></script>
<script src="/js/jquery.cookie.js" type="text/javascript"></script>
<script src="/js/jquery.timers.js" type="text/javascript"></script>
<script src="/js/jquery.input.js" type="text/javascript"></script>
<script src="/js/jquery.j.tool.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/buildHtml.js"></script>
<script src="/js/jquery.SuperSlide.2.1.1.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/pagination.js"></script>
<script type="text/javascript" src="/js/DatePicker/WdatePicker.js"></script>
<script type="text/javascript">
var queryOptions;
var houseGJbox,/*houseSee / houseGJ 的*/
chuzu=getParam('chuzus');
var houseData;
function doSearch(callback){
  var a=$('form[name=form1]').serialize();
  YW.ajax({
    type: 'POST',
    url: '/c/house/rent/listAll',
    data:a,
    mysuccess: function(data){
        houseData=JSON.parse(data);
        buildHtmlWithJsonArray("id_House_list",houseData['page']['data']);
        Page.setPageInfo(houseData['page']);
        setTableFix();
        if(callback){
          callback();
        }
    }
  });
}
function doSearchAndSelectFirst(){
  doSearch(function(){
    if(houseData.page.data.length>0){
      getSider(houseData.page.data[0].id);
    }
  });
}
function getSider(id){
    if(id){
        $.get('/v/house/houseSee_rent.html?id='+id, function(data) {
            var sideTop=parseInt(getSideH());
            $('#sideCont').html(data);
            $('#sideCont').css({top:sideTop});
            var sideHeadHeight=$('#sideCont').find('.sideHead').innerHeight()+3;
            $('#sideCont').css({'padding-top':sideHeadHeight})
        });
    }else{
    }
}

function getShenHeText(lock){
  if(lock==1){
    return "审";
  }else{
    return "未";
  }
}

function shenheFy(id , obj){
  YW.ajax({
    type: 'POST',
    url: '/c/house/rent/toggleShenHe?id='+id,
    mysuccess: function(data){
        var json = JSON.parse(data);
        if(json.sh==1){
          $(obj).text('审');
          $(obj).css('color','green');
        }else{
          $(obj).text('未');
          $(obj).css('color','red');
        }
    }
  });
}

function houseEdit(id){
  art.dialog.open("/house/house_rent_edit.html?id="+id)
}

function deletehouse(id){
  art.dialog.confirm('删除后不可恢复，确定要删除吗？', function () {
  YW.ajax({
    type: 'POST',
    url: '/c/house/rent/physicalDelete?id='+id,
    mysuccess: function(data){
      doSearch();
      alert('删除成功');
    }
  });
  },function(){},'warning');
}

function sideBtnFun(){

    $('.sideCont').on('click', '.btns', function(event) {
        event.preventDefault();
        /* Act on the event */
        var Thi=$(this),
        ThiType=Thi.data('type');
        if(ThiType=='add_company'){
        }
        return false;
    });
    $('.sideCont').on('click', '.btns', function(event) {
        var Thi=$(this),
        ThiHid=Thi.data('hid'),
        ThiType=Thi.data('type');
        if(ThiType=='addGenjin'){
            if(houseGJbox)houseGJbox.close();
            houseGJbox=art.dialog({
                follow: document.getElementById('addGenjinBtn'),
                content: '加载中...',
                title:'添加跟进',
                left:20,
                id:'houseGenjinBox',
                width:'250px',
                padding:'0'
            });
            // jQuery ajax   
            $.ajax({
                url: '/v/house/house_genjin_add.html',
                mysuccess: function (data) {
                    houseGJbox.content(data);
                },
                cache: false
            });
        }else if(ThiType=='fav'){
            var ThiIsFav=Thi.attr('fav'),
            url,param={
                houseId:$('#dimHouseId').text(),
                chuzu:chuzu
            }
            if(ThiIsFav==1){
                url='addRent';
                alertStr="收藏成功";
                dimStr='<i class="iconfont">&#xe62e;</i> 已收藏';
                Thi.attr('fav',0).attr('title','已收藏');
            }else{
                url='deleteRent';
                alertStr="已取消收藏";
                dimStr='<i class="iconfont">&#xe648;</i> 收藏';
                Thi.attr('fav',1).attr('title','点此收藏');
            }
            YW.ajax({
                type: 'POST',
                url: '/c/house/fav/'+url,
                data:param,
                mysuccess: function(data){
                    //var json = JSON.parse(data);
                    alert(alertStr);
                    Thi.html(dimStr);
                },complete:function(){
                    
                }
            });
        }else if(ThiType=='map'){
            art.dialog.open('/house/house_see_map.html',{id:'seemap',height:400,width:900});
        }else if(ThiType=='copy'){
            alert('不给复制');
        }else{
            return false;
        }
    });
}
function autoComplete(id){
    $(document).find('body').prepend('<div id="autoCompleteBox" class="autocomplete"></div>');
    var Thi=id,
    oldVal,
    ThiOptTop=Thi.offset().top,
    ThiOptLeft=Thi.offset().left,
    ThiWidth=Thi.width(),
    autocomplete=$('#autoCompleteBox');
    autocomplete.width(ThiWidth).css({'position':'absolute','top':ThiOptTop,'left':ThiOptLeft,'z-index':'999','max-height':'180px','overflow':'auto'});
    Thi.on('keyup',function(event) {
        var Thi=$(this),
        ThiVal=Thi.val(),
        param={
            search:ThiVal
        }
        if(oldVal!=ThiVal){
            oldVal=ThiVal;
            YW.ajax({
                type: 'POST',
                url: '/c/areas/prompt',
                data:param,
                success: function(data){
                    var d=JSON.parse(data);
                    autocomplete.html('');
                    $.each(d['houses'], function(index, val) {
                        autocomplete.prepend('<a href="#" title="'+val.area+'">'+val.area+'<i>'+val.area+'</i><b>'+val.area+'</b></a>');
                    });
                },complete:function(){
                    
                },beforeSend:function(){}
            });
        }
    });
}
$(document).ready(function() {
// 加载侧边按钮功能
    autoComplete($('#search'))
    sideBtnFun();
//添加提示框
    $(document).find('[data-toggle="tooltip"]').tooltip();
    $.get('/c/config/getQueryOptions', function(data) {
        queryOptions=JSON.parse(data);
        buildHtmlWithJsonArray("id_lxing",queryOptions['lxing'],true);
        buildHtmlWithJsonArray("id_fxing",queryOptions['fxing'],true);
        buildHtmlWithJsonArray("id_zhuangxiu",queryOptions['zhuangxiu'],true);
        buildHtmlWithJsonArray("id_quyu",queryOptions['quyu'],true);
        buildHtmlWithJsonArray("id_zhuangtai",queryOptions['ztai_rent'],true , true);
        buildHtmlWithJsonArray("id_fangshi",queryOptions['rent_type'],true , true);
        Page.Init();
        doSearchAndSelectFirst();
    });
    $('.id_House_list').on('click', 'a', function(event) {
        var Thi=$(this),
        rel=Thi.data('rel'),
        this_hid=Thi.data('hid');
    });
    $('.TableB').on('click', 'tr', function(event) {
        var Thi=$(this),
        ThiHid=Thi.data('hid');
        getSider(ThiHid);
        // Thi.toggleClass('selected');
        return false;
    });
    $.get('menuTop.html', function(data) {
        $('#menuTop').html(data);
    });
});
$(window).resize(function() {      //类别
});
</script>
<style type="text/css">
  .selected{
    background-color: blue;
  }

.shenhe_0{color:red;}
.shenhe_1{color:green;}
</style>
</head>
<body>
<div class="html list title addSide">
    <div class="header">
        <div class="maxHW title">
            <ul class="menuLi clearfix title" id="menuTop"></ul>
        </div>
  <form class="form-horizontal form1" onsubmit="doSearch();return false;" role="form" name="form1">
    <input type="hidden" class="userInput" name="xpath" value="">
    <input type="hidden" class="hidden" name="pageInput" value="">
    <div class="form-group clearfix" style="background:#FFF; width:980px;">
      <div class="btn-group btn-sm">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" style="padding-right: 11px;padding-left: 10px;">
          综合 <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li><label><input type="radio" name="scope" value="all" checked onclick="doSearch();"> 所有</label>
          <li><label><input type="radio" name="scope" value="comp" onclick="doSearch();"> 公司</label>
          <li><label><input type="radio" name="scope" value="seeGX" onclick="doSearch();"> 共享</label>
        </ul>
      </div>
      <div class="btn-group btn-sm">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"  style="padding-right: 10px;padding-left: 10px;">
          状态 <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li onclick="doSearch();"><label><input type="radio" name="ztai" value="" checked> 所有</label>
          <li class="id_zhuangtai"  onclick="doSearch();"><label><input type="radio" name="ztai" value="${code}"> ${name}</label>
        </ul>
      </div>
      <div class="input-group input-group-max" style="width: 265px;">
        <span class="input-group-addon">智能</span>
        <!-- <input type="hidden" class="form-control input-sm" name="Address" id="Address"> -->
        <input type="text" class="form-control input-sm" name="search" id="search"  onkeyup="keyupdeal(event);" onkeydown="keydowndeal(event);" onclick="keyupdeal(event);" autocomplete="off" placeholder="楼盘/路段/电话/编号">
          <div id="suggest" style="position:absolute;height:400px;overflow-y:auto;z-index: 100;display:none"></div>
      </div>
      <div class="btn-group btn-sm">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"  style="padding-right: 11px;padding-left: 11px;">
          区域<span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li class="id_quyu"><label><input type="checkbox" name="quyus" value="${name}"> ${name}</label>
        </ul>
      </div>
      <div class="btn-group btn-sm">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"  style="padding-right: 11px;padding-left: 11px;">
          楼型<span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu" >
          <li class="id_lxing"><label><input type="checkbox" name="lxing" value="${name}" /> ${name}</label></li>
        </ul>
      </div>
      <div class="btn-group btn-sm">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"  style="padding-right: 11px;padding-left: 11px;">
          房型<span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu" >
          <li class="id_fxing"><label><input type="checkbox" name="fxing" value="${value}" /> ${name}</label></li>
        </ul>
      </div>
      <div class="btn-group btn-sm">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"  style="padding-right: 11px;padding-left: 11px;">
          装潢<span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li class="id_zhuangxiu"><label><input type="checkbox" name="zxiu" value="${name}" /> ${name}</label></li>
        </ul>
      </div>
      <div class="btn-group btn-sm">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"  style="padding-right: 11px;padding-left: 11px;">
          方式<span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li><label><input type="radio" name="fangshi" value="" checked="checked" /> 不限</label></li>
          <li class="id_fangshi" style="display:none"><label><input type="radio" name="fangshi" value="${code}" /> ${name}</label></li>
        </ul>
      </div>
    </div>

    <div class="form-group clearfix" style="line-height: 30px;">
      <div class="input-group">
        <span class="input-group-addon">面积</span>
        <input type="text" class="form-control input-sm" name="mjiStart">
        <input type="text" class="form-control input-sm" name="mjiEnd">
      </div>
      <div class="input-group">
        <span class="input-group-addon">租金</span>
        <input type="text" class="form-control input-sm" name="zjiaStart">
        <input type="text" class="form-control input-sm" name="zjiaEnd">
      </div>
      <div class="input-group">
        <span class="input-group-addon">楼层</span>
        <input type="text" class="form-control input-sm" name="lcengStart">
        <input type="text" class="form-control input-sm" name="lcengEnd">
      </div>
      <div class="input-group">
        <span class="input-group-addon">建筑<br/>年代</span>
        <input type="text" class="form-control input-sm" name="yearStart">
        <input type="text" class="form-control input-sm" name="yearEnd">
      </div>
      <div class="input-group">
        <span class="input-group-addon" style="padding:8px;">发布<br/>日期</span>
        <input type="text" class="form-control input-sm" name="dateStart" id="idTimes" onFocus="var timeend=$dp.$('idTime');WdatePicker({onpicked:function(){idTime.focus();},maxDate:'#F{$dp.$D(\'idTime\')}'})">
        <input type="text" class="form-control input-sm" name="dateEnd" id="idTime" onFocus="WdatePicker({minDate:'#F{$dp.$D(\'idTimes\')}'})">
      </div>
      <div class="btn-group">
        <button type="submit" class="btn btn-sms btn-primary btn_subnmit">搜索</button>
      </div><br>
      <div class="btn-group">
        <button type="button" class="btn btn-sms" data-type="qingkong" onclick="window.location.href='house_list.html?nav='getParamS">清空</button>
      </div>
    </div>
  </form>
 
  <table class="table table-nopadding TableH  mainCont" >
    <tr>
      <th>编号</th>
      <th>操作</th>
      <th>状态</th>
      <th>区域</th>
      <th>楼盘名称</th>
      <th>楼型</th>
      <th>户型</th>
      <th>面积</th>
      <th>租金</th>
      <th>楼层</th>
      <th>装潢</th>
      <th class="sy">发布时间</th>
    </tr>
  </table>

    </div>
    <div class="bodyer mainCont">
  <div class="sideCont" id="sideCont"></div>
        <div class="maxHW" style="min-width: 700px;">

  <table class="table table-hover table-striped table-nopadding TableB" >
    <tbody>
    <tr data-hid="${id}" style="display:none;" class="id_House_list">
      <td><span class="piliang hidden"><input type="checkbox" name="ids" value="${id}"> </span>${id}</td>
      <td style="width:50px;">
        <a href="##" auth="fy_sh" class="shenhe_${sh}" data-hid="${id}" runscript="true" data-rel="del" onclick="shenheFy(${id},this)">getShenHeText(${sh})</a>
        <a href="#" auth="fy_edit" class="edit" data-hid="${id}" onclick="houseEdit(${id})" data-rel="edit">改</a>
        <a href="##" auth="fy_del" class="del" data-hid="${id}" data-rel="del" onclick="deletehouse(${id})">删</a>
      </td>
      <td>${ztai}</td>
      <td>${quyu}</td>
      <td>${area} ${dhao}-${fhao}</td>
      <td>${lxing}</td>
      <td>${hxf}-${hxt}-${hxw}</td>
      <td>${mji}</td>
      <td>${zjia}</td>
      <td>${lceng}/${zceng}</td>
      <td>${zxiu}</td>
      <td class="sy">${dateadd}</td>
    </tr>
    </tbody>
  </table>
        </div>
    </div>
    <div class="footer">
        <div class="maxHW mainCont ymx_page foot_page_box"></div>
    </div>
</div>
</body>
</html>