<style type="text/css">
  div#rMenu {position:absolute; visibility:hidden; top:0;width:150px; text-align: left;padding: 2px;}
  div#rMenu ul li{
    margin: 5px 0;
    padding: 0 15px;
    cursor: pointer;
    list-style: none outside none;
  }
  
</style>
<script type="text/javascript">
var rMenu;
var id;
var node;
    var setting = {
      view: {
        showIcon: false,
        addDiyDom: addDiyDom,
        showLine:false,
        dblClickExpand: false,
      },
      data: {
        simpleData: {
          enable: true
        }
      },
      callback: {
        onRightClick: OnRightClick,
        onClick: onClick
      }
     };

  YW.ajax({
    type: 'POST',
    url: '/c/sys/rolesList?cid=$${cid}',
    data:'',
    mysuccess: function(data){
        var result=JSON.parse(data);
        $.fn.zTree.init($("#treeDemo"), setting, result.result);
        rMenu = $("#rMenu");
    }
  });

function onClick(event, treeId, treeNode, clickFlag) {
  node = treeNode;
  console.log(treeNode);
  roleId = treeNode.id;
  
  if(clickFlag!=null){
    var treeObj = $.fn.zTree.getZTreeObj(treeId);
    treeObj.expandNode(treeNode);
    if(treeNode.type=='role'){
      loadAuthorites();  
    }
  }
}


function addNode(data){
  var newNodeData = JSON.parse(data);
  var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
    treeObj.addNodes(node, newNodeData);
}

function updateNode(title){
  node.name= title;
  var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
  treeObj.updateNode(node);
}

function OnRightClick(event, treeId, treeNode) {
  console.log(treeId);
  var treeObj = $.fn.zTree.getZTreeObj(treeId);
  treeObj.selectNode(treeNode);
  onClick(event, treeId, treeNode,null);
  if(event.target.tagName!='SPAN'){
    return;
  }
  id = treeNode.id;
  showRMenu(treeNode.type, event.clientX, event.target.parentElement.parentElement.offsetTop+10);
}
function showRMenu(type, x, y) {
  $("#rMenu a").show();
  if(type == "comp"){
    $('#editThis').hide();
    $('#delThis').hide();
  }if(type == "role"){
    $('#add_role').hide();
  }
  
  rMenu.css({"top":y+"px", "left":x+"px", "visibility":"visible"});
  $("body").bind("mousedown", onBodyMouseDown);
}
function hideRMenu() {
      if (rMenu) rMenu.css({"visibility": "hidden"});
      $("body").unbind("mousedown", onBodyMouseDown);
    }
function onBodyMouseDown(event){
    rMenu.css({"visibility" : "hidden"});
}

function addDiyDom(treeId, treeNode) {
  $("#" + treeNode.tId + "_ico").remove();
  // $("#" + treeNode.tId).css('display','inline');
  var aObj = $("#" + treeNode.tId + "_a");
  if(treeNode.cnum!=null){
    var editStr = "<span style='color:#09f;margin-right:0px;'>"+ treeNode.cnum +" </span>";
    aObj.prepend(editStr);  
  }
}

function delNode(){
    YW.ajax({
      type: 'POST',
      url: '/c/sys/deleteRole',
      data:'roleId='+node.id,
      mysuccess: function(data){
          var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
          treeObj.removeNode(node);
          alert('成功删除职务: '+node.name);
      }
    });
}

function addRole(){
    dialog_see=art.dialog.open('/v/settings/roleAdd.html?&cid='+id,{
      id:'roleAdd',
      title:'添加职务',
      height:100,
      width:500
    })

}
function editRole(){
    dialog_see=art.dialog.open('/v/settings/roleEdit.html?&id='+id,{
      id:'roleEdit',
      title:'修改职务',
      height:100,
      width:500
    })

}
</script>

<script type="text/javascript">
$(document).ready(function() {
    $('[data-toggle=tooltip]').tooltip();
    $('.sideCont').on('click', '.btns', function(event) {
        event.preventDefault();
        /* Act on the event */
        var Thi=$(this),
        ThiType=Thi.data('type');
    });
    $('#rMenu').on('click', 'a', function(event) {
        var Thi=$(this),
        ThiUl=Thi.parents('ul'),
        ThiLi=Thi.parents('li'),
        ThiUrl=Thi.attr('href'),
        ThiType=Thi.data('type');
        if(ThiType=='delThis'){
            art.dialog.confirm('删除职务后不可恢复，确定要删除吗？', function () {
                delNode();
            },function(){
                
            },'warning');
            return false;
        }else{
            return false;
        }
    });
// seeRecords
// seeGenjin
// addGroup
// moveTo
// editThis
// delThis

});
</script>
<div class="sideHead">
    职务列表
</div>

<table class="table table-nopadding side_table" width="100%">
  <tbody>
    <tr class="list">
      <td>
        <div class="zTreeDemoBackground left">
          <ul id="treeDemo" class="ztree jtree"></ul>
        </div>
      </td>
    </tr>
  </tbody>
</table>

<div class="sideFoot">
  <ul>
    <li>
      <a href="" data-toggle="tooltip" ></a>
    </li>
  </ul>
</div>

<div id="rMenu" class="list-group">
  <a href="javascript:void(0)" auth="sz_unit_add" data-type="add_role" id="add_role" class="list-group-item" onclick="addRole();">添加职务</a>
  <a href="javascript:void(0)" auth="sz_unit_edit" data-type="editThis" id="editThis" type="zw" class="list-group-item" onclick="editRole();">修改</a>
  <a href="javascript:void(0)" auth="sz_unit_del" data-type="delThis" id="delThis" type="zw" class="list-group-item">删除</a>

</div>